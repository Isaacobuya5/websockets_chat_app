<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Web Sockets</title>
</head>
<body>
    <h3>Chat App</h3>
    <!-- <button id="increment">+</button> -->
    <form id='messageForm'>
        <input type="text" placeholder="Send message" id="message"/>
        <button type="submit">Send</button>
    </form>
    <button id="send-location">Send location</button>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script>
        const socket = io()

        // Elements
        const $messageForm = document.querySelector("#messageForm");
        const $messageFormInput = $messageForm.querySelector('input');
        const $messageFormButton = $messageForm.querySelector('button');
        const $locationButton = document.querySelector('#send-location');
        // receive event server is sending
        // socket.on('countUpdated', (count) => {
        //     console.log('The count has been updated', count);
        // })

        // document.querySelector('#increment').addEventListener('click', () => {
        //     // sending event from client
        //     socket.emit('increment');
        // })
        socket.on('message', message => {
            console.log(message);
        })

        $messageForm.addEventListener('submit', event => {
            event.preventDefault();

            $messageFormButton.setAttribute('disabled', 'disabled')
            // disable the form
            const message = document.querySelector('#message').value;
            // event.target.elements.message.value
            socket.emit('sendMessage', message, (error) => {
                // re-enable the form
                $messageFormButton.removeAttribute('disabled');
                $messageFormInput.value = '';
                $messageFormInput.focus()
                if (error) {
                    return console.log(error);
                }
                console.log('The message was delivered!')
            });
        })

        socket.on('clientMessage', chatMessage => {
            console.log(chatMessage);
        })

        $locationButton.addEventListener('click', () => {
            $locationButton.setAttribute('disabled', 'disabled');
            if (!navigator.geolocation) {
                return alert('Geolocation is not supported by your browser');
            }
            navigator.geolocation.getCurrentPosition((position) => {
                console.log(position);
                socket.emit('sendLocation', {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                },() => {
                    $locationButton.removeAttribute('disabled')
                    console.log("Location shared")
                })
            })
        })
    </script>
</body>
</html>